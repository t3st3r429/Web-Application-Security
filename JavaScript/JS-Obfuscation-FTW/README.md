# JS Obfuscation. FTW!

## Challenge Text

> Obfuscation?!!

## Writeup

For this challenge the only hint we're given is that it involves obfuscation. We'll start by viewing the ```HTML``` source code, specifically the code for the ```submit``` button. This way we can get an idea of what is done with our password. Once we view the inline JavaScript that gets fired once the button is clicked, we'll notice that it's really hard to read. This is known as [code obfuscation](https://www.freecodecamp.org/news/make-your-code-secure-with-obfuscation/ "freeCodeCamp Article On Code Obfuscation"), a tactic for making your code a little more secure by making it harder to read/understand.

```html
<button onclick="javascript:if (document.getElementById(&quot;pass&quot;).value==&quot;j00w1n&quot;){alert(&quot;You WIN!&quot;);window.location += &quot;?lvl_password=&quot;+document.getElementById(&quot;pass&quot;).value}else {alert(&quot;WRONG! Try again!&quot;)}">Check Password</button>
```

To get a better idea of what's going on in this code, we'll tidy it up a bit by removing the ```<button>``` tags and other parts of the code that are only relevant to the ```HTML```. Then we'll [pretty print](https://en.wikipedia.org/wiki/Prettyprint "Wikipedia Article On Pretty Printing") the ```JavaScript``` code by indenting and putting every section of code on it's own line.

```js
if (document.getElementById(&quot;pass&quot;).value==&quot;j00w1n&quot;)
{
    alert(&quot;You WIN!&quot;);
    window.location += &quot;?lvl_password=&quot;+document.getElementById(&quot;pass&quot;).value
}
else
{
    alert(&quot;WRONG! Try again!&quot;)
}
```

Next, we'll deobfuscate this code further by removing every instance of an [HTML character entity](https://www.w3schools.com/html/html_entities.asp "W3 Schools Lesson On HTML Entities") and replacing it with the character it represents. Lucky for us, there's only one [HTML character entity](https://www.w3schools.com/html/html_entities.asp "W3 Schools Lesson On HTML Entities") used over and over and that's ```&quot;```, which represents ```"``` (double quotes). Replacing all instances of ```&quot;``` with ```"``` leaves us with the following code.

```js
if (document.getElementById("pass").value=="j00w1n")
{
    alert("You WIN!");
    window.location += "?lvl_password="+document.getElementById("pass").value
}
else
{
    alert("WRONG! Try again!")
}
```

Now that we've deobfuscated and pretty printed the inline JavaScript code for the password button, we'll see that the program checks if our password is "```j00w1n```". If it is, we're done with the challenge and we're rerouted to the success page. If not, a failure message is alerted to the screen.

```js
if (document.getElementById("pass").value=="j00w1n") // Is our password equal to j00w1n?
{
    alert("You WIN!"); // Success text
    window.location += "?lvl_password="+document.getElementById("pass").value // Reroute to success page
}
else
{
    alert("WRONG! Try again!") // Failure text
}
```

Even though we have the password and can complete the challenge, the real strangeness in this level comes from how the button was created. If you inspect the ```HTML``` several lines above the password submit button, you'll find another script. Within these ```<script>``` tags, you'll find embedded ```JavaScript``` but it's a lot harder to read than the code we just deobfuscated.

```html
<script language="javascript">
var _0x4e9d=["\x66\x72\x6F\x6D\x43\x68\x61\x72\x43\x6F\x64\x65","\x77\x72\x69\x74\x65"];document[_0x4e9d[0x1]](String[_0x4e9d[0x0]](0x3c,0x62,0x75,0x74,0x74,0x6f,0x6e,0x20,0x6f,0x6e,0x63,0x6c,0x69,0x63,0x6b,0x3d,0x27,0x6a,0x61,0x76,0x61,0x73,0x63,0x72,0x69,0x70,0x74,0x3a,0x69,0x66,0x20,0x28,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x3d,0x3d,0x22,0x6a,0x30,0x30,0x77,0x31,0x6e,0x22,0x29,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x59,0x6f,0x75,0x20,0x57,0x49,0x4e,0x21,0x22,0x29,0x3b,0x77,0x69,0x6e,0x64,0x6f,0x77,0x2e,0x6c,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x20,0x2b,0x3d,0x20,0x22,0x3f,0x6c,0x76,0x6c,0x5f,0x70,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3d,0x22,0x2b,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x7d,0x65,0x6c,0x73,0x65,0x20,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x57,0x52,0x4f,0x4e,0x47,0x21,0x20,0x54,0x72,0x79,0x20,0x61,0x67,0x61,0x69,0x6e,0x21,0x22,0x29,0x7d,0x27,0x3e,0x43,0x68,0x65,0x63,0x6b,0x20,0x50,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3c,0x2f,0x62,0x75,0x74,0x74,0x6f,0x6e,0x3e));
</script>
```

For our first step in the deobfuscation process we'll start making the code just a bit more readable by removing the ```<script>``` tags and putting every statement on it's own line (statements end with ```;```).

```js
var _0x4e9d = ["\x66\x72\x6F\x6D\x43\x68\x61\x72\x43\x6F\x64\x65","\x77\x72\x69\x74\x65"];

document[_0x4e9d[0x1]](String[_0x4e9d[0x0]](0x3c,0x62,0x75,0x74,0x74,0x6f,0x6e,0x20,0x6f,0x6e,0x63,0x6c,0x69,0x63,0x6b,0x3d,0x27,0x6a,0x61,0x76,0x61,0x73,0x63,0x72,0x69,0x70,0x74,0x3a,0x69,0x66,0x20,0x28,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x3d,0x3d,0x22,0x6a,0x30,0x30,0x77,0x31,0x6e,0x22,0x29,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x59,0x6f,0x75,0x20,0x57,0x49,0x4e,0x21,0x22,0x29,0x3b,0x77,0x69,0x6e,0x64,0x6f,0x77,0x2e,0x6c,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x20,0x2b,0x3d,0x20,0x22,0x3f,0x6c,0x76,0x6c,0x5f,0x70,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3d,0x22,0x2b,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x7d,0x65,0x6c,0x73,0x65,0x20,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x57,0x52,0x4f,0x4e,0x47,0x21,0x20,0x54,0x72,0x79,0x20,0x61,0x67,0x61,0x69,0x6e,0x21,0x22,0x29,0x7d,0x27,0x3e,0x43,0x68,0x65,0x63,0x6b,0x20,0x50,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3c,0x2f,0x62,0x75,0x74,0x74,0x6f,0x6e,0x3e));
```

Next, we'll replace the hexadecimal escape sequences in the first line with their equivalent characters. If we start by removing the escape sequence (```\x```), we'll be left with the following array.

```js
var _0x4e9d = ["66726F6D43686172436F6465","7772697465"];
```

Now we'll convert both hexadecimal strings in the array to their character equivalents by using a [hexadecimal to text converter](https://www.rapidtables.com/convert/number/hex-to-ascii.html "Rapid Tables Hex To Text Tool").

* 66726F6D43686172436F6465 = ```fromCharCode```
* 7772697465 = ```write```

Now we have deobfuscated the first line. ```_0x4e9d``` is a variable that stores an array with two strings whose values are ```fromCharCode``` and ```write```. That leaves us with the following code.

```js
var _0x4e9d = ["fromCharCode","write"];

document[_0x4e9d[0x1]](String[_0x4e9d[0x0]](0x3c,0x62,0x75,0x74,0x74,0x6f,0x6e,0x20,0x6f,0x6e,0x63,0x6c,0x69,0x63,0x6b,0x3d,0x27,0x6a,0x61,0x76,0x61,0x73,0x63,0x72,0x69,0x70,0x74,0x3a,0x69,0x66,0x20,0x28,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x3d,0x3d,0x22,0x6a,0x30,0x30,0x77,0x31,0x6e,0x22,0x29,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x59,0x6f,0x75,0x20,0x57,0x49,0x4e,0x21,0x22,0x29,0x3b,0x77,0x69,0x6e,0x64,0x6f,0x77,0x2e,0x6c,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x20,0x2b,0x3d,0x20,0x22,0x3f,0x6c,0x76,0x6c,0x5f,0x70,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3d,0x22,0x2b,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x7d,0x65,0x6c,0x73,0x65,0x20,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x57,0x52,0x4f,0x4e,0x47,0x21,0x20,0x54,0x72,0x79,0x20,0x61,0x67,0x61,0x69,0x6e,0x21,0x22,0x29,0x7d,0x27,0x3e,0x43,0x68,0x65,0x63,0x6b,0x20,0x50,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3c,0x2f,0x62,0x75,0x74,0x74,0x6f,0x6e,0x3e));
```

Even though the code is still obfuscated we can already see that the ```_0x4e9d``` array's contents are accessed almost immediately in the next line of code. Instead of using ```0```, or ```1``` the array elements are accessed using the hexadecimal equivalents. Let's replace the two parts of the code where the ```_0x4e9d``` array is accessed.

```js
[_0x4e9d[0x1]](String[_0x4e9d[0x0]] // Before

[_0x4e9d[1]](String[_0x4e9d[0]] // After replacing the hexadecimal with it's numeric equivalent.

["write"]](String["fromCharCode"] // The line above reduces down to this line.
```

At this point in our deobfuscation, it should be pretty easy to see that this program writes to the ```HTML``` document the result of the [fromCharCode](https://www.w3schools.com/jsref/jsref_fromcharcode.asp "W3 Schools Lesson On fromCharCode Function") function.

```js
document["write"](String["fromCharCode"](0x3c,0x62,0x75,0x74,0x74,0x6f,0x6e,0x20,0x6f,0x6e,0x63,0x6c,0x69,0x63,0x6b,0x3d,0x27,0x6a,0x61,0x76,0x61,0x73,0x63,0x72,0x69,0x70,0x74,0x3a,0x69,0x66,0x20,0x28,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x3d,0x3d,0x22,0x6a,0x30,0x30,0x77,0x31,0x6e,0x22,0x29,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x59,0x6f,0x75,0x20,0x57,0x49,0x4e,0x21,0x22,0x29,0x3b,0x77,0x69,0x6e,0x64,0x6f,0x77,0x2e,0x6c,0x6f,0x63,0x61,0x74,0x69,0x6f,0x6e,0x20,0x2b,0x3d,0x20,0x22,0x3f,0x6c,0x76,0x6c,0x5f,0x70,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3d,0x22,0x2b,0x64,0x6f,0x63,0x75,0x6d,0x65,0x6e,0x74,0x2e,0x67,0x65,0x74,0x45,0x6c,0x65,0x6d,0x65,0x6e,0x74,0x42,0x79,0x49,0x64,0x28,0x22,0x70,0x61,0x73,0x73,0x22,0x29,0x2e,0x76,0x61,0x6c,0x75,0x65,0x7d,0x65,0x6c,0x73,0x65,0x20,0x7b,0x61,0x6c,0x65,0x72,0x74,0x28,0x22,0x57,0x52,0x4f,0x4e,0x47,0x21,0x20,0x54,0x72,0x79,0x20,0x61,0x67,0x61,0x69,0x6e,0x21,0x22,0x29,0x7d,0x27,0x3e,0x43,0x68,0x65,0x63,0x6b,0x20,0x50,0x61,0x73,0x73,0x77,0x6f,0x72,0x64,0x3c,0x2f,0x62,0x75,0x74,0x74,0x6f,0x6e,0x3e));
```

Once the [fromCharCode](https://www.w3schools.com/jsref/jsref_fromcharcode.asp "W3 Schools Lesson On fromCharCode Function") function is run with all those hexadecimal values, our code is reduced to this.

```js
document["write"](<button onclick='javascript:if (document.getElementById("pass").value=="j00w1n"){alert("You WIN!");window.location += "?lvl_password="+document.getElementById("pass").value}else {alert("WRONG! Try again!")}'>Check Password</button>)
```

And now we can finally see what all this obfuscated code did. This was the program responsible for rendering the password submit button we looked at earlier. It also checked for wether our password was equal to ```j00w1n```. But again, none of this deobfuscation was ever needed. The challenge can be completed without ever even knowing all this obfuscated code existed. All that was really needed was to inspect the code within the password submit ```<button>```.

Password - ```j00w1n```
